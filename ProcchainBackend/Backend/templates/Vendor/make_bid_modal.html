<!--

    Write all JS fucntions in browse_jobs.html in the footer block

-->
<div class="modal fade" id="make_bids" tabindex="-1" role="dialog" aria-labelledby="make_bids" aria-hidden="true"> 
    <div class="modal-dialog" role="document"> 
        <div class="modal-content"> 
            <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> 
                <h2 class="modal-title" id="make_bids_modal_title">
                    Make bid
                </h2> 
            </div> 
            <div class="modal-body">
                <form role="form" id = "form" class="form-horizontal form-groups-bordered">
                    <div class="form-group">
                        <label for="field-1" class="col-sm-3 control-label">Tender Name</label>
                            <div class="col-sm-5"> 
                                <input type="text" class="form-control" id="tenderName" placeholder="Steel Tender" > 
                            </div> 
                    </div>
                    <div class="form-group">
                        <label for="field-2" class="col-sm-3 control-label">Organisation</label>
                            <div class="col-sm-5"> 
                                <input type="text" class="form-control" id="organization" placeholder="Tata Steel" > 
                            </div> 
                    </div>
                    <div class="form-group">
                        <label for="field-3" class="col-sm-3 control-label">Deadline</label>
                            <div class="col-sm-5"> 
                                <input type="text" class="form-control" id="field-3" placeholder="30/02/2020"> 
                            </div> 
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Proposed Amount</label>
                        <div class="col-sm-5"> 
                            <div class="input-group"> 
                                <span class="input-group-addon" style="color: #000000">â‚¹</span> 
                                <input type="text" id = "amount" class="form-control"> <span class="input-group-addon" style="color: #000000">.00</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Upload files</label>
                            <div class="col-sm-5"> 
                                <input type="file" id = "bids" name = "bids" class="form-control file2 btn btn-primary" multiple="1" data-label="Browse Files" />
                            </div>
                    </div>               
            </div> 
            <div class="modal-footer"> 
                <button type="submit" onclick= "uploadBids()" class="btn btn-primary" id = "apply_now_modal_btn">Make bid</button> 
                <button type="button" class="btn btn-success" data-dismiss="modal">Close</button> 
            </div> 
        </div> 
    </div> 

</div>
</form> 
<!--

    Write all JS fucntions in browse_jobs.html in the footer block

-->

<script type="text/javascript">
    // form upload
    function uploadBids(){
        console.log('ajax')
        $body = $("make_bids");

        $(document).on({
            ajaxStart: function() { $body.addClass("loading");    },
            ajaxStop: function() { $body.removeClass("loading"); }    
        });

        $('#form').submit(function(e){
            e.preventDefault();
            console.log('in call')
            var formData = new FormData(this);
            $.ajaxSetup({
            headers: { "X-CSRFToken": '{{csrf_token}}' }
            });
            
            $.ajax({
                url: "{% url 'make_bids' 10047 %}",
                type: 'POST',
                csrfmiddlewaretoken: '{{ csrf_token }}',
                data: formData,
                success: function (response) {
                    console.log(response)
                    hashValue = response;
                    $("#success-alert").show();
                    document.getElementById("form").reset();
                    setTimeout(function() { $("#success-alert").hide(); }, 5000);
                    if(response.error){
                        $.each(response.errors, function(name, error){
                            $("#error-alert").val("<small class='text-muted error'>' + error + '</small>")
                            $("#error-alert").show()
                            setTimeout(function() { $("#error-alert").hide(); }, 5000);
                        })
                    }
                },
                cache: false,
                contentType: false,
                processData: false,
                enctype: 'multipart/form-data'
            });
            return false
        // end
        });
    }

   </script>
</script>
