{% extends 'Middleman/layout/header.html' %}
{% load static %}
{% block middleman %}
    <h2>
        Current Orders
    </h2>

    <table class="table table-bordered responsive table-hover table-primary text-center">
        <thead>
            <tr>
                <td>Tender Name</td>
                <td>Vendor Name</td>
                <td>Arrival</td>
                <td>Dispatch</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Steel Pipes</td>
                <td>Tata Steel Ltd.</td>
                <td>12th Feb</td>
                <td>14th Feb</td>
                <td><a class="btn btn-primary" href="#enter_otp" onclick="getState(0)" data-toggle = "modal" data-target="#enter_otp">Arrived</a></td>
                <!-- <td class="text-success bg-success">Arrived</td> -->
                <td><a class="btn btn-info" href="{% url 'testing' %}" onclick="getState(1)" data-toggle = "modal" data-target="#enter_otp">Dispatched</a></td>
            </tr>
        </tbody>
    </table>
    {% include 'Middleman/OTP.html' %}
{% endblock %}

{% block middleman_footer %}

<script>
    function getState(state){
        sendOTP()
        console.log('getState');
        $("#enter_otp_body_div").empty();
        // if (state == 0) {
        //     $("#enter_otp_body_div").append("Arrived!");
        // } else {
        //     $("#enter_otp_body_div").append("Dispatched!");
        // }
        
    };
    function sendOTP() {
        $(".error").html("").hide();
        console.log('in fx');
        var number = '9820712020'//'{{ request.session.user_data.details.ph_no }}';
        if (number.length == 10 && number != null) {
            console.log('get Number checked');
            var input = {
                "mobile_number" : number,
                "action" : "send_otp",
                "formData" : JSON.stringify($("#form1").serializeArray()),
                "csrfmiddlewaretoken" : $("input[name=csrfmiddlewaretoken]").val()
            };
            $.ajax({
                url : "{% url 'sendOTP' %}",
                type : 'POST',
                data : input,
                success : function(response) {
                    console.log('success');
                    $("#otp").change( function(){
                    if ( $("#otp").val() == response)
                    {
                        console.log("in function")
                        $("#submit").prop("disabled",false);
                    }
                    else {
                        console.log("out of function");
                    }
                });
            
                    $("#response").html("<div class='alert alert-success' id = 'success'>OTP sent successfully</div>")
                    
                },
                error : function(xhr, status, error) {
                    $("#response").html("<div class='alert alert-danger' id = 'success'>Some Error Occurred!</div>")
                    $("#resendOTP").css("visibility", "visible")
                }
            });
            
        } else {
            $(".error").html('Please enter a valid number!')
            $(".error").show();
        }
    }
    
</script>

{% endblock %}